
{% extends "base/base.html" %}



{% block title %}
    Services
{% endblock title %}






{% block navbar %}
    {% include  "base/nav_base.html" %}
{% endblock navbar %}



{% block body %}

<div class="container-fluid top-padding" style="padding-left: 0px;padding-right: 0px;">
        <div class="row no-gutters" style="margin-left: 0px;/*padding-left: 0px;*/position: relative;">
            <div class="col-sm-12 col-lg-12 col-xl-12 offset-lg-1 offset-xl-0" style="width: 100%;margin-left: 0px;height: 400px;padding-left: 0px;padding-right: 0px;">
                    <div id='all-serv-map'></div>
                    	

                    <pre id='coordinates' class='coordinates'></pre>



            </div>
            <div class="col-lg-12" style="position: relative;">
                <div class="map-search">
                    <form>
                        <div class="form-row">
                            <div class="col">
                                <h6 id="map-search-heading">Recherche Simple</h6>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="col">
                                <form>
                                    <div class="form-row" id="map-search-adv" style="display: none;">
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-4" style="padding: 15px;padding-bottom: 0px;"><input class="form-control" type="text" placeholder="Jours" style="border-radius: 20px;"></div>
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-4" style="padding: 15px;padding-bottom: 0px;"><select class="form-control" style="border-radius: 20px;"><option value="" selected="">Sexe</option><option value="13">Homme</option><option value="Femme">Femme</option></select></div>
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-4 col-xl-4"
                                            style="padding: 15px;padding-bottom: 0px;"><input class="form-control" type="text" placeholder="Age" style="border-radius: 20px;"></div>
                                    </div>
                                    <div class="form-row">
                                        <div class="col-12 col-sm-6 col-lg-3" style="padding: 15px;padding-bottom: 0px;"><input class="form-control" type="text" placeholder="Mot-cle" style="border-radius: 20px;"></div>
                                        <div class="col-12 col-sm-6 col-lg-3" style="padding: 15px;padding-bottom: 0px;"><input class="form-control" type="text" placeholder="Location" style="border-radius: 20px;"></div>
                                        <div class="col-12 col-sm-6 col-lg-3" style="padding: 15px;padding-bottom: 0px;"><select class="form-control" placeholder="Categorie" style="border-radius: 20px;"><option value="" selected="">Categorie</option><optgroup label="Netoayage"><option value="12">Maison</option><option value="13">Voiture</option></optgroup><optgroup label="Pinture"><option value="">Mur</option><option value="">Bois</option></optgroup></select></div>
                                        <div
                                            class="col-12 col-sm-6 col-lg-3" style="padding: 15px;padding-bottom: 0px;text-align: center;"><button class="btn btn-primary" type="submit" style="border-radius: 20px;width: 70%;">Rechercher</button><i class="fa fa-chevron-down" id="map-search-adv-icon" style="float: right;margin-top: 10px;transition: .25s;"></i></div>
                            </div>
                            </form>
                        </div>
                </div>
                </form>
            </div>
        </div>
    </div>
    </div>
<!-- <div id='map' ></div>
<pre id='coordinates' class='coordinates'></pre>
 -->
<hr>
<br>


<form method="GET" >
	<input type="text" name="q" placeholder="nom service" value="{{ request.GET.q}}">
	<input type="text" name="q1" placeholder="categorie" value="{{ request.GET.q1}}">
	<input type="submit" name="">
</form>
<hr>
	
	
	{% for cat in categories %}


		<p>id: {{cat.service.id}}</p>
		<p>Service: {{cat.service.service_name}}</p>
		<p>Discription: {{cat.service.discription}}</p>
		
		<p>Profile: {{cat.service.profile.get_full_name}}</p>
		
		<p>Categorie: {{cat.categorie.libelle}}</p>
		
		<a href="{% url 'service_detail' pk=cat.service.pk %}"><button class="btn btn-primary">detail</button></a>
		<hr><br>
	{% endfor %}
<br>

	<div class="pagination">
	    <span class="step-links">
	        {% if categories.has_previous %}
	            <a href="?page=1">&laquo; first</a>
	            <a href="?page={{ categories.previous_page_number }}">previous</a>
	        {% endif %}

	        <span class="current">
	            Page {{ categories.number }} of {{ categories.paginator.num_pages }}.
	        </span>

	        {% if categories.has_next %}
	            <a href="?page={{ categories.next_page_number }}">next</a>
	            <a href="?page={{ categories.paginator.num_pages }}">last &raquo;</a>
	        {% endif %}
	    </span>
	</div>

{% endblock body %}





<script type="text/javascript">
	{% block jsmap %}
	    $(document).ready(function(){


			//create a map
			mapboxgl.accessToken = 'pk.eyJ1IjoibXNhbWlyIiwiYSI6ImNqdGphZWVkZDBzd3M0YWtpM2Y0bzhhNG4ifQ.CIn3tX2_VC_N0hMh1lzAGg';
			const map = new mapboxgl.Map({
			  container: 'all-serv-map',
			  style: 'mapbox://styles/msamir/cjtkion1e2tux1fnrxdhvs5lc',
			  center: [3.424100, 36.780000],
			  zoom: 7
			});



			var geojson_planned = {
				type: 'FeatureCollection',
				features: [
				
						{% for i in categories_list %}
						    {
						    type: 'Feature',
						    geometry: {
						        type: 'Point',
						        coordinates: [parseFloat('{{ i.service.langtitude }}')  ,parseFloat( '{{ i.service.latitude }}') ]
						    } ,
						    properties: {
						        title: '{{ i.service.service_name }}',
						        type: '{{ i.categorie.libelle }}',
						    }
						    },
						{% endfor %}
					]
				};

				console.log(geojson_planned)
				
				geojson_planned.features.forEach(function(marker) {
		        var el = document.createElement('div');
		        el.className = 'marker';
		        el.style.backgroundImage = "url(/static/images/" + marker.properties.type +".png";
		        el.style.width = '40px';
		        el.style.height = '55px';
		     
			    // create the popup
			    var popup = new mapboxgl.Popup({ offset: 25 })
			    .setHTML('<h1> ' +marker.properties.type+ '</h1> <br><button type="submit" class="btn btn-primary">Ajouter</button>');
			    
			     
			    // add marker to map
			    new mapboxgl.Marker(el)
			    .setLngLat(marker.geometry.coordinates).setPopup(popup)
			    .addTo(map);
			   
			   });

		

			//Geo Coder (search)
			var acctok = map.addControl(new MapboxGeocoder({
			accessToken: mapboxgl.accessToken
			}));


			//get user location using button
			var uloc = map.addControl(new mapboxgl.GeolocateControl({
			    positionOptions: {
			        enableHighAccuracy: true
			    },
			    trackUserLocation: true
			}));

			//zoom in and zoom out using button
			var nav = new mapboxgl.NavigationControl();
			var cont = map.addControl(nav, 'top-right');


})
     
	{% endblock jsmap %}







	/*geojson_planned.features.forEach(function(marker) {

				// create a HTML element for each feature
					var el = document.createElement('div');
					el.className = 'marker-light-red';

					// visited
					new mapboxgl.Marker(el)
					.setLngLat(marker.geometry.coordinates)
					.setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
					.setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>'))
					.addTo(map);
				});
*/

</script>







